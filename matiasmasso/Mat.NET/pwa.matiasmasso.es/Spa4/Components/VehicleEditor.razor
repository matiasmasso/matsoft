@inherits _ComponentBase
@using System.Net.Http.Formatting

<div>

    @if (Model != null)
    {

        <EditForm Model="@Model" OnValidSubmit=@ValidFormSubmitted >
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="form-group">
                Matricula: <InputText @bind-Value="Model.Model.Matricula" class="form-control" />
            </div>
            <div class="form-group">
                Bastidor: <InputText @bind-Value="Model.Model.Bastidor" class="form-control" />
            </div>
 @*           <div class="form-group">
                Alta: <InputDate @bind-Value="Model.Model.Alta" class="form-control" />
            </div>
            <div class="form-group">
                Baixa: <InputDate type=password @bind-Value="Model.Model.Baixa" class="form-control" />
            </div>
*@
            <br />

            <div class="Buttons">
                <!--<button type="submit" form="my-form-ref" class="btn btn-success" value="Update"/>-->
                <button type="submit" class="btn btn-success">Update</button>
                <input type="button" class="btn btn-secondary" value="Delete" />
                <input type="button" class="btn btn-secondary" value="Cancel" />
            </div>

        </EditForm>
    }

</div>
@code {

    private VehicleDTO? _model;

    [Parameter]
    public VehicleDTO? Model
    {
        get => _model;
        set
        {
            if (_model == value ) return;
            _model = value;
            ModelChanged.InvokeAsync(value);
        }
    }

    [Parameter]
    public EventCallback<VehicleDTO> ModelChanged { get; set; }   

    [Parameter]
    public EventCallback<VehicleDTO> SaveRequest { get; set; }   



    async void ValidFormSubmitted(EditContext editContext)
    {
        if(editContext.IsModified())
        {
            VehicleDTO model = (VehicleDTO)editContext.Model;
            var url = Globals.ApiUrl("Vehicle");

            var content = Newtonsoft.Json.JsonConvert.SerializeObject(Model);
            var response = await base.http.PostAsync(url, content, new JsonMediaTypeFormatter());
            if ((int)response.StatusCode == 200)
                NavigationManager.NavigateTo("Vehicles");
            else
                throw new Exception("error on updating vehicle");
        }
    }



}