@inherits _Base
@using Microsoft.AspNetCore.Components.Web.Virtualization

<CascadingValue Value="contextMenuItem">
    @if(Model != null)
    {
        <div class="Grid">
        <Virtualize Items="Model" Context="item">

                <a class="Item" href="#" @onclick="(()=>ItemClick(item))" @onclick:preventDefault>
                    <div class="Id">@item.Id</div>
                    <div class="Fch">@string.Format("{0:dd/MM/yy}",item.Fch)</div>
                    <div class="Concept">@item.Concept</div>
                    <div class="Amount">@string.Format("{0:N2}",item.Amount)</div>
                    <div class="User">@item.UsrCreated.Nom</div>

                    @if (item == contextMenuItem)
                    {
                        <ContextMenu_Deprecated Model="contextMenu" OnClick="@(()=>contextMenuItem = null)"></ContextMenu_Deprecated>
                    }
                </a>
          </Virtualize>
        </div>
    }
 </CascadingValue>

@code {
    [Parameter] public List<CcaModel> Model { get; set; }
    [Parameter] public EventCallback<CcaModel> SelectedItemChanged { get; set; }

    /// <summary>
    /// the item which has the context menu open, if any
    /// </summary>
    CcaModel contextMenuItem = null;
    ContextMenuModel contextMenu = null;

    /// <summary>
    /// The user clicked on the item caption.
    /// Forward the event to parent component so it takes the default action
    /// </summary>
    /// <param name="args">the item the context menu refers to</param>
    void ItemClick(Object args)
    {
        CcaModel item = (CcaModel)args;
        SelectedItemChanged.InvokeAsync(item);
    }

    /// <summary>
    /// The user clicked on the item ellipsis.
    /// Either collapse the context menu if it was being displayed
    /// or display it if it was hidden
    /// </summary>
    /// <param name="args">the item the context menu refers to</param>
    void ToggleContextMenu(Object args)
    {
        CcaModel item = (CcaModel)args;
        if (item == contextMenuItem)
            contextMenuItem = null;
        else
        {
            contextMenuItem = item;
            contextMenu = ContextMenuModel.Factory(item);
        }
    }


}
