<div class="Wrapper">
    <input type="@Mode.ToString()" @oninput="@CheckIfDirty" @onchange="@CheckIfDirty" autofocus />

    @if (IsLoading)
    {
        <div class="CallToAction">
            <img src="/img/spinner-24.gif" />
        </div>
    }
    else
    {
        <a href="#" class="@(isShowingButton ? "":"Hidden")" @onclick="ButtonClickAsync" @onclick:preventDefault>

            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                <path d="M180.7 155.3L281.4 256l-100.7 100.7c-6.25 6.25-6.25 16.38 0 22.62s16.38 6.25 22.62 0l112-112C318.4 264.2 320 260.1 320 256s-1.562-8.188-4.688-11.31l-112-112c-6.25-6.25-16.38-6.25-22.62 0S174.4 149.1 180.7 155.3zM0 96v320c0 35.35 28.65 64 64 64h320c35.35 0 64-28.65 64-64V96c0-35.35-28.65-64-64-64H64C28.65 32 0 60.65 0 96zM384 64c17.64 0 32 14.36 32 32v320c0 17.64-14.36 32-32 32H64c-17.64 0-32-14.36-32-32V96c0-17.64 14.36-32 32-32H384z" />
            </svg>
        </a>
    }

</div>



@code {
    [Parameter] public Modes Mode { get; set; } = Modes.Text;
    [Parameter] public EventCallback IsEditing { get; set; }
    [Parameter] public EventCallback<string> CallToAction { get; set; }
    [Parameter] public bool IsLoading { get; set; } = false;
    private bool isDirty;
    private string value;

    public enum Modes
    {
        Text,
        Email,
        Password
    }

    protected override void OnInitialized(){

    }

    bool isShowingButton = false; //false; el 8/5/23 va deixar de funcionar @oninput

    void CheckIfDirty(ChangeEventArgs args)
    {
        value = args.Value?.ToString() ?? "";
        if (string.IsNullOrEmpty(value))
        {
            isDirty = false;
            isShowingButton = false;
        }
        else
        {
            isDirty = true;
            isShowingButton = true;
            IsEditing.InvokeAsync();
        }
    }

    async Task ButtonClickAsync()
    {
        isShowingButton = false;
        isDirty = false;
        await CallToAction.InvokeAsync(value);
    }
}
