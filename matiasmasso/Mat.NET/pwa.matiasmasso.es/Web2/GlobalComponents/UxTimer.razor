@inject CultureService culture

    <div class="Wrapper">
        @Text()
    </div>

@code {
    [Parameter] public DateTime? FchTo { get; set; }
    [Parameter] public EventCallback FchReached { get; set; }

    private System.Threading.Timer? timer;
    private int seconds = 0;

    protected override void OnParametersSet()
    {
        if (FchTo != null && timer == null)
        {
            timer = new System.Threading.Timer(_ => { InvokeAsync(StateHasChanged); }, null, 1000, 1000);
        }
        base.OnParametersSet();
    }

    private TimeSpan TimeLeft() => (TimeSpan)(FchTo - DateTime.Now);


    string Text() {
        var timeLeft = TimeLeft();
        if(timeLeft.TotalSeconds <=0){
            if (FchReached.HasDelegate)
                FchReached.InvokeAsync();
        }

        var sb = new System.Text.StringBuilder();

        if (timeLeft.Days > 1)
        {
            sb.AppendFormat("{0:00} {1} ", timeLeft.Days,  culture.Localize("days"));
        }
        else if (timeLeft.Days > 0){
            sb.AppendFormat("1 {0} ",  culture.Localize("day"));
        }

        if (timeLeft.Hours > 1)
        {
            sb.AppendFormat("{0:00} {1} ", timeLeft.Hours,  culture.Localize("hours"));
        }
        else if (timeLeft.Hours > 0)
        {
            sb.AppendFormat("1 {0} ",  culture.Localize("hour"));
        }

        if (timeLeft.Minutes > 1)
        {
            sb.AppendFormat("{0:00} {1} ", timeLeft.Minutes,  culture.Localize("minutes"));
        }
        else if (timeLeft.Minutes > 0)
        {
            sb.AppendFormat("1 {0} ",  culture.Localize("minute"));
        }

        if (timeLeft.Seconds > 1)
        {
            sb.AppendFormat("{0:00} {1} ", timeLeft.Seconds,  culture.Localize("seconds"));
        }
        else if (timeLeft.Seconds > 0)
        {
            sb.AppendFormat("1 {0} ",  culture.Localize("seconds"));
        }

        return sb.ToString();

    }

}
