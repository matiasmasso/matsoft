@page "/content/{url1}/{url2?}/{url3?}/{url4?}/{url5?}"
@inherits _ComponentBase


@if (model == null)
{
    <Loading></Loading>
}
else
{
    <div class="Wrapper">

        <div class="Content">
            <h1>@model.Caption.Tradueix(base.Lang())</h1>

            @((MarkupString)content)
        </div>

        <div class="Boxes">
            <NoticiasGallery VisibleCount="4" HideThis="model.Guid"></NoticiasGallery>
        </div>

    </div>
}

<UxError ProblemDetails="problemDetails"></UxError>


@code {
    [Parameter] public string? Url1 { get; set; }
    [Parameter] public string? Url2 { get; set; }
    [Parameter] public string? Url3 { get; set; }
    [Parameter] public string? Url4 { get; set; }
    [Parameter] public string? Url5 { get; set; }
    private ContentModel? model;
    private string? content;
    private CacheDTO cache;
    private ProblemDetails problemDetails;

    protected override async Task OnInitializedAsync()
    {
        cache = await base.RequestCacheAsync(CacheDTO.Table.TableIds.Noticia);
    }

    protected override async Task OnParametersSetAsync()
    {
        if (model == null && base.IsLoadingCache == false)
        {
            string[] segments = { Url1, Url2, Url3, Url4, Url5 };
            string url = string.Join("/", segments.Where(x => !string.IsNullOrEmpty(x)));
            string urlSegment = url.Replace(".html", "");
            model = await PostAsync<string, ContentModel>(urlSegment, "Content/FromUrlSegment");
            content = cache.ExpandPlugins(model.Html(base.Lang()), base.Lang());
        }
    }


}
