@page "/Vehicles"
@layout ProLayout

@using Spa.Shared
@using Spa.ViewModels

@inject HttpClient Http
@inject AppState AppState
@inject NavigationManager NavigationManager
@inject Microsoft.Extensions.Localization.IStringLocalizer<Vehicles> Loc


@if (viewModel!.LoadStatus == Globals.LoadStatusEnum.Loading) {
    <div>Loading...</div>
} else {
    <div class="Wrapper">

        <h1>@Loc["Title"]</h1>
        <SearchBox @bind-Value="@viewModel.SearchTerm"></SearchBox>

        <Virtualize Items="@viewModel.Items()" Context="item">
             <NavLink href="@item.Url()">
                <div class="Marca Truncate">@(item.Marca ?? "")</div>
                <div class="Matricula Truncate">Matrícula @(item.Matricula ?? "")</div>
                <div class="Conductor Truncate">Conductor @(item.Conductor?.Nom ?? "")</div>
              </NavLink>
        </Virtualize>
    </div>
}




@code {

    private VehiclesViewModel? viewModel;

    protected override  Task OnInitializedAsync()
    {
        viewModel = new VehiclesViewModel(AppState);
        viewModel.OnStateChange += StateHasChanged;
        viewModel.Fetch(Http);
        return base.OnInitializedAsync();
    }
}
