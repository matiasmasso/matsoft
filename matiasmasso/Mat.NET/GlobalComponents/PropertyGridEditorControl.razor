
<div class="Wrapper">
    @if (Item != null)
    {
        if (Item.Cod == PropertyGridModel.Cods.Boolean)
        {
            <Toggle Value="(bool?)Item.Value" CanEdit="CanEdit" ObjChanged="ValueChanged"></Toggle>
        }
        else if (Item.Cod == PropertyGridModel.Cods.Fch)
        {
            <UxTextbox @bind-Value="Item.Value" @bind-Value:event="ObjChanged" ValueChanged="ValueChanged" CanEdit="CanEdit"></UxTextbox>
@*            <UxFch @bind-Value="Item.Value" @bind-Value:event="ObjChanged" ValueChanged="ValueChanged" CanEdit="CanEdit"></UxFch>
*@        }
        else if (Item.Cod == PropertyGridModel.Cods.Tel)
        {
            <UxTel @bind-Value="Item.Value" @bind-Value:event="ObjChanged" ValueChanged="ValueChanged" CanEdit="CanEdit"></UxTel>
        }
        else if (Item.Cod == PropertyGridModel.Cods.Email)
        {
            <UxEmail @bind-Value="Item.Value" @bind-Value:event="ObjChanged" ValueChanged="ValueChanged" CanEdit="CanEdit"></UxEmail>
        }
        else if (Item.Cod == PropertyGridModel.Cods.Password)
        {
            <UxPassword @bind-Value="Item.Value" @bind-Value:event="ObjChanged" CanEdit="CanEdit"></UxPassword>
        }
        else if (Item.Cod == PropertyGridModel.Cods.Iban)
        {
            <UxIban Value="(IbanModel)Item.Value" ObjChanged="ValueChanged" ></UxIban>
        }
        else if (Item.Cod == PropertyGridModel.Cods.Dropdown)
        {
            <Dropdown Values="Item.Values"
              Value="(ISearchable?)Item.Value"
              ValueChanged="DropdownChanged"
              CanEdit="CanEdit"></Dropdown>
                @*ContextMenu="Item.ContextMenu"*@              
        }
        else if (Item.Cod == PropertyGridModel.Cods.Multiline)
        {
            <UxTextarea @bind-Value="Item.Value" @bind-Value:event="ObjChanged" ValueChanged="ValueChanged" CanEdit="CanEdit"></UxTextarea>
        }
        else
        {
            <UxTextbox @bind-Value="Item.Value" @bind-Value:event="ObjChanged" ValueChanged="ValueChanged" CanEdit="CanEdit"></UxTextbox>
        }
    }

</div>

@code {

    [Parameter] public bool CanEdit { get; set; }
    [Parameter] public bool IsDirty { get; set; }
    [Parameter] public int? MaxLength { get; set; }
    [Parameter] public EventCallback<PropertyGridModel.Item> SetDirty { get; set; }
    [Parameter] public EventCallback<PropertyGridModel.Item> RequestToAddNew { get; set; }
    [Parameter] public PropertyGridModel.Item Item { get; set; }

    private bool isEditing = false;
    private bool isShowingSelector = false;

    private void ValueClicked()
    {
        if (Item!.Cod == PropertyGridModel.Cods.Dropdown)
        {
            isShowingSelector = true;
            isEditing = true;
        }
        else if (Item!.Cod == PropertyGridModel.Cods.Boolean)
        {
            if ((bool)(Item.Value ?? false))
            {
                Item!.Value = false;
            }
            else
            {
                Item!.Value = true;
            }
        }
        else
        {
            isEditing = true;
        }
    }


    private void DropdownChanged(object args)
    {
        Item.Value = args;
        SetDirty.InvokeAsync(Item);
        isEditing = false;
        isShowingSelector = false;
    }

    private void ValueChanged(object args)
    {
        Item.Value = args;
        SetDirty.InvokeAsync(Item);
    }

    private void AddNewRequest()
    {
        RequestToAddNew.InvokeAsync(Item);
    }

}
