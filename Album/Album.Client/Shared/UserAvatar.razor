@inject ProfileCacheService Cache

@if (profile is null)
{
    <div class="avatar-placeholder">@placeholder</div>
}
else if (!string.IsNullOrWhiteSpace(profile.AvatarUrl))
{
    <img src="@profile.AvatarUrl"
         class="rounded-circle"
         style="width:@Size;height:@Size;object-fit:cover;" />
}
else
{
    <div class="avatar-placeholder">@initials</div>
}

@code {
    [Parameter] public string Size { get; set; } = "40px";

    private UserProfileDto? profile;
    private string initials = "";
    private string placeholder = "…";

    protected override async Task OnInitializedAsync()
    {
        profile = await Cache.GetAsync();

        if (profile is not null)
        {
            initials = GetInitials(profile.Name);
        }
    }

    private string GetInitials(string name)
    {
        if (string.IsNullOrWhiteSpace(name))
            return "?";

        var parts = name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length == 1)
            return parts[0][0].ToString().ToUpper();

        return $"{parts[0][0]}{parts[^1][0]}".ToUpper();
    }
}