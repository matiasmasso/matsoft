@if (Value is not null)
{
    <div class="Wrapper">

        <div class="IconText">
            <div class="IconContainer">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                    <path class="fa-primary"
                          d="M256 320c13.3 0 24-10.7 24-24V168c0-13.3-10.7-24-24-24s-24 10.7-24 24v128c0 13.3 10.7 24 24 24zm0 33.1c-17.4 0-31.4 14.1-31.4 31.4S238.6 416 256 416s31.4-14.1 31.4-31.4S273.4 353.1 256 353.1z" />
                    <path class="fa-secondary" style="fill:#ffcc00"
                          d="M506.3 417l-213.3-364c-16.3-28-57.5-28-74 0L5 417C-10.6 444.9 9.8 480 42.7 480h426.6c32.9 0 53.4-35 37-63z" />
                </svg>
            </div>

            <div>
                <p>@(isShowingDetails? Title : Title.Truncate(100))</p>

                <a class="SeeMore @(isShowingDetails ? "Hidden" : "")"
                   href="#"
                   @onclick="ShowDetails"
                   @onclick:preventDefault>
                    veure més...
                </a>

                <a class="SeeLess @(isShowingDetails ? "" : "Hidden")"
                   href="#"
                   @onclick="HideDetails"
                   @onclick:preventDefault>
                    veure menys...
                </a>

                @if (isShowingDetails && !string.IsNullOrEmpty(StackTrace))
                {
                    <a class="SeeMore @(isShowingStackTrace ? "Hidden" : "")"
                       href="#"
                       @onclick="ShowStackTrace"
                       @onclick:preventDefault>
                        veure stack trace...
                    </a>

                    <p class="@(isShowingStackTrace ? "" : "Hidden")">@StackTrace</p>

                    <a class="SeeLess @(isShowingStackTrace ? "" : "Hidden")"
                       href="#"
                       @onclick="HideStackTrace"
                       @onclick:preventDefault>
                        tanca stack trace...
                    </a>
                }
            </div>
        </div>

        <div class="ButtonsBar">
            <a href="#" class="ButtonClose"
               @onclick="Close"
               @onclick:preventDefault>
                Entesos
            </a>
        </div>
    </div>
}


@code {
    [Parameter] public Exception? Value { get; set; }
    [Parameter] public EventCallback<Exception?> ValueChanged { get; set; }

    private string? Title { get; set; }
    private string? Detail { get; set; }
    private string? StackTrace { get; set; }

    private bool isShowingDetails;
    private bool isShowingStackTrace;

    protected override void OnParametersSet()
    {
        if (Value is null)
            return;

        Title = Value.Message;
        Detail = Value.InnerException?.Message;
        StackTrace = Value.StackTrace;

        // Reset UI state when a new error arrives
        isShowingDetails = false;
        isShowingStackTrace = false;
    }

    private Task Close() =>
        ValueChanged.InvokeAsync(null);

    private void ShowDetails() => isShowingDetails = true;
    private void HideDetails() => isShowingDetails = false;

    private void ShowStackTrace() => isShowingStackTrace = true;
    private void HideStackTrace() => isShowingStackTrace = false;
}
