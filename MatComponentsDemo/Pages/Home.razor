@page "/"
@using MatComponents.PropertyGrid
@using MatComponents.PropertyGrid.Internal.Attributes
@using MatComponents.PropertyGrid.Internal.Metadata
@using MatComponents.PropertyGrid.Internal.Models

<PropertyGrid SelectedObject="@Model"
              Lookups="@Lookups"
              SearchLookups="@SearchLookups"
              OnUpdate="Save" />

@code {
    private ContractModel Model = new();

    public Dictionary<string, IEnumerable<object>> Lookups { get; set; }
    public Dictionary<string, Func<string, Task<IEnumerable<object>>>> SearchLookups { get; set; }

    protected override void OnInitialized()
    {
        Lookups = new()
        {
            ["ContactId"] = new List<object>
            {
                new LookupItem<Guid>(Guid.Parse("aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa"), "John Doe"),
                new LookupItem<Guid>(Guid.Parse("bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb"), "Jane Smith")
            }
        };

        SearchLookups = new()
        {
            ["OwnerId"] = async term =>
            {
                await Task.Delay(200); // simulate DB
                return new List<object>
                {
                    new LookupItem<Guid>(Guid.NewGuid(), $"Owner matching '{term}' 1"),
                    new LookupItem<Guid>(Guid.NewGuid(), $"Owner matching '{term}' 2")
                };
            }
        };
    }

    private Task Save(object? obj)
    {
        Console.WriteLine("Saved!");
        return Task.CompletedTask;
    }


public class ContractModel
{
    [PgDisplay(Label = "Contract ID", Order = 0)]
    public Guid Id { get; set; } = Guid.NewGuid();

    [PgDisplay(Label = "Contact", Order = 1)]
    [PgCategory("General")]
    public Guid ContactId { get; set; }

    [PgDisplay(Label = "Owner", Order = 2)]
    [PgCategory("General")]
    public Guid OwnerId { get; set; }

    [PgDisplay(Label = "Monthly Rent", Order = 3)]
    [PgCategory("Financial")]
    public decimal MonthlyRent { get; set; }

    [PgDisplay(Label = "Start Date", Order = 4)]
    [PgCategory("Financial")]
    public DateTime StartDate { get; set; } = DateTime.Today;
}
}
