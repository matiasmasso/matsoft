@page "/album"
@inject ApiService ApiService

<h3>AlbumPage</h3>

@if (rootFolder == null)
{
    <p><em>Loading...</em></p>
}else if(selectedFolder == null)
{
    <h3>Folder Explorer</h3>

    <p><em>Select a folder to view its contents.</em></p>
    <FolderView Folder="rootFolder" ItemSelected="ItemSelectedHandler" />

}
else
{
    @if (files == null)
    {
        <p><em>Loading...</em></p>
    }
    else
    {
        <a href="#" @onclick="@(()=>selectedFolder=null)" @onclick:preventDefault>@selectedFolder.Name</a>
        <div class="gallery">
            @foreach (var img in files)
            {
                <div class="image-card">
                    <p>@img.Name</p>
                    <img src="data:image/jpeg;base64,@img.ThumbnailBase64"
                         alt="@img.Name"  />
                </div>
            }
        </div>
    }

}


@code {
    private FolderModel? rootFolder;
    private FolderModel? selectedFolder;
    private List<FileModel>? files;

    protected override async Task OnInitializedAsync()
    {
        // Call your Web API endpoint
        rootFolder = await ApiService.GetAsync<FolderModel>("album");
    }

    async Task ItemSelectedHandler(FolderModel args)
    {
        selectedFolder = args;
        files = await ApiService.PostAsync<string, List<FileModel>>(args.Name!, "Album/Imgs");

    }

}
