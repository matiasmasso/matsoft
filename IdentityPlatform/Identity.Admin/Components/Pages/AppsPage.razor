@page "/apps"
@inject IdentityApiClient Api
@inject ToastService Toasts

<h3>Applications</h3>
<p>@DateTime.Now</p>


@if (apps == null)
{
    <p>Loading...</p>
}
else
{
    <ul>
        @foreach (var app in apps)
        {
            <li>
                <a href="/apps/@app.Id">@app.Name (@app.Key)</a>
            </li>
        }
    </ul>
}

<Modal @ref="createAppModal" Title="Create App">
    <div class="form-group">
        <label>Key</label>
        <input class="form-control" @bind="newAppKey" />
    </div>

    <div class="form-group">
        <label>Name</label>
        <input class="form-control" @bind="newAppName" />
    </div>

    <div class="mt-3">
        <button class="btn btn-primary" @onclick="CreateApp">Create</button>
    </div>
</Modal>

<button @onclick="() => createAppModal!.Open()">Create App</button>
<a href="#" @onclick="() => createAppModal!.Open()" @onclick:preventDefault>Create App anchor</a>


@code {
    private Modal? createAppModal;

    private string newAppKey = "";
    private string newAppName = "";

    private List<AppDto>? apps;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            apps = await Api.GetAppsAsync();
        }
        catch (ApiException ex)
        {
            Toasts.ShowError(ex.Message);
        }

    }

    private async Task CreateApp()
    {
        try
        {
            await Api.CreateAppAsync(new CreateAppRequest(newAppKey, newAppName));
            apps = await Api.GetAppsAsync();
            createAppModal?.Close();

            Toasts.ShowSuccess("Application created successfully");
        }
        catch (Exception ex)
        {
            Toasts.ShowError(ex.Message);
        }

    }


}
