@using Identity.DTO

<div class="user-list">
    <input class="form-control mb-2"
           placeholder="Cerca usuari..."
           @bind="search"
           @bind:event="oninput" />

    <ul class="list-group">
        @foreach (var u in FilteredUsers)
        {
            <li class="list-group-item user-item @(u.Id == SelectedUserId ? "active" : "")"
                @onclick="() => SelectUser(u)">
                <strong>@u.UserName</strong>
                <div class="small text-muted">@u.Email</div>
            </li>
        }
    </ul>
</div>

@code {
    [Parameter] public List<UserDto>? Users { get; set; } 
    [Parameter] public Guid? SelectedUserId { get; set; }
    [Parameter] public EventCallback<UserDto> OnUserSelected { get; set; }

    private string search = string.Empty;

    private IEnumerable<UserDto> FilteredUsers =>
        string.IsNullOrWhiteSpace(search)
            ? Users
            : Users.Where(u =>
                (u.UserName?.Contains(search, StringComparison.OrdinalIgnoreCase) ?? false) ||
                (u.Email?.Contains(search, StringComparison.OrdinalIgnoreCase) ?? false));

    private async Task SelectUser(UserDto user)
    {
        if (OnUserSelected.HasDelegate)
            await OnUserSelected.InvokeAsync(user);
    }
}