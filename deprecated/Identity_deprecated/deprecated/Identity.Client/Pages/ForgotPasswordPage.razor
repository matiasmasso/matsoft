@page "/forgot-password"
@layout AuthLayout
@inject HttpClient Http
@inject NavigationManager Nav

<h3 class="mb-3 text-center">Forgot Password</h3>

<p class="text-muted text-center">
    Enter your email and we’ll send you a reset link.
</p>

@if (error != null)
{
    <div class="alert alert-danger">@error</div>
}

@if (success != null)
{
    <div class="alert alert-success">@success</div>
}

<EditForm Model="@model" OnValidSubmit="Submit">
    <DataAnnotationsValidator />

    <div class="mb-3">
        <label>Email</label>
        <InputText @bind-Value="model.Email" class="form-control" />
        <ValidationMessage For="@(() => model.Email)" />
    </div>

    <button class="btn btn-primary w-100" disabled="@isSubmitting">
        @(isSubmitting ? "Sending..." : "Send Reset Link")
    </button>
</EditForm>

<div class="text-center mt-3">
    <a href="/login">Back to login</a>
</div>

@code {
    ForgotPasswordRequest model = new();
    string error;
    string success;
    bool isSubmitting = false;

    protected override void OnInitialized()
    {
        model.ClientUrl = Nav.BaseUri.TrimEnd('/');
    }

    async Task Submit()
    {
        error = null;
        success = null;
        isSubmitting = true;

        var response = await Http.PostAsJsonAsync("api/auth/forgot-password", model);

        isSubmitting = false;

        if (!response.IsSuccessStatusCode)
        {
            error = "Something went wrong. Please try again.";
            return;
        }

        success = "If an account exists, a reset link has been sent.";

        await Task.Delay(2000);
        Nav.NavigateTo("/login");
    }
}