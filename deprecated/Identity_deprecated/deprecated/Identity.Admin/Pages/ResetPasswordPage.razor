@page "/reset-password"
@inject HttpClient Http
@inject NavigationManager Nav

<h3>Reset Password</h3>

<input type="password" @bind="newPassword" placeholder="New Password" />
<button @onclick="Reset">Reset Password</button>
<Error Errors="_errors" OnClear="HandleClear" />


@code {
    private string newPassword = "";
    private Guid userId;
    private string token;
    private List<string> _errors = new();

    protected override void OnInitialized()
    {
        var uri = Nav.ToAbsoluteUri(Nav.Uri);
        var query = System.Web.HttpUtility.ParseQueryString(uri.Query);

        userId = Guid.Parse(query["userId"]);
        token = query["token"];
    }

    private async Task Reset()
    {
        var request = new
        {
            UserId = userId,
            Token = token,
            NewPassword = newPassword
        };

        await Http.PostAsJsonAsync("auth/reset-password", request);
    }

    private async Task HandleClear()
    {
        _errors?.Clear();
        await InvokeAsync(StateHasChanged);
    }
}
